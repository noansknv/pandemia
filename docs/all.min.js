raf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)},caf=window.cancelAnimationFrame||window.mozCancelAnimationFrame,Object.prototype.inherits=function(n){this.prototype=Object.create(n.prototype),this.prototype.constructor=this};var an=Math.abs,f=Math.cos,cn=Math.sin,n=Math.tan,t=Math.atan,s=Math.atan2,e=Math.ceil,c=Math.floor,r=Math.max,o=Math.min,x=Math.pow,u=Math.sqrt,l=Math.round,fn=Math.random,a=Date.now,h=Math.PI,d=function(n,t,e){return n<t?t:null!=e&&e<n?e:n},w=function(n,t){return c(fn()*(t-n))+n},m=function(n){return n[w(0,n.length)]};function p(n,t,e){var r=M.createElement("canvas");return r.width=n,r.height=t,e(r.getContext("2d"),r),r}var v=function(){var e={},t={};M.body.addEventListener("keydown",function(n){n.keyCode in e&&(n.preventDefault(),t[n.keyCode]=-1,e[n.keyCode]=1)}),M.body.addEventListener("keyup",function(n){n.keyCode in e&&(n.preventDefault(),t[n.keyCode]=1,e[n.keyCode]=0)}),this.p=function(n){if(n instanceof Array){for(var t=0;t<n.length;t++)if(e[n[t]])return 1;return 0}return!!e[n]},this.b=function(n){n.forEach(function(n){e[n]=0,t[n]=0})}},g=function(n,t,e,r){var i=this;i.w=n,i.h=t,i.ww=e,i.wh=r,i.ofx=0,i.ofy=0,i.tg=0,i.setWorldSize=function(n,t){i.ww=n,i.wh=t},i.setTarget=function(n){i.tg=n},i.txPCoord=function(n,t){return{x:n-i.ofx,y:t-i.ofy}},i.txRCoord=function(n){return{x:n.x-i.ofx,y:n.y-i.ofy,r:n.b.r-i.ofx,b:n.b.b-i.ofy}},i.inView=function(n){var t=i.txRCoord(n);return(0<=t.r&&t.r<=i.w||0<=t.x&&t.x<=i.w)&&(0<=t.b&&t.b<=i.h||0<=t.y&&t.y<=i.h)},i.u=function(){if(i.tg){var n,t=0,e=i.w/2,r=i.h/2;i.ww<=i.w?n=i.tg.x:i.tg.x<=e?n=i.tg.x:i.tg.x>e&&i.tg.x+e<=i.ww?n=e:i.tg.x>e&&i.tg.x+e>i.ww&&(n=i.w-(i.ww-i.tg.x)),i.wh<=i.h?t=i.tg.y:i.tg.y<=r?t=i.tg.y:i.tg.y>r&&i.tg.y+r<=i.wh?t=r:i.tg.y>r&&i.tg.y+r>i.wh&&(t=i.h-(i.wh-i.tg.y)),i.ofx=i.tg.x-n,i.ofy=i.tg.y-t}},i.r=function(n){n&&(n instanceof Array||(n=[n]),n.forEach(function(n){if(i.inView(n)){var t=i.txRCoord(n);n.r(t,t.x,t.y)}}))}},b=function(){var n=this;n.reset=function(){n.ex=0,n.t={s:0,fo:0},F.e=0,n.to=null},n.start=function(){n.reset(),n.init(),n.loop()},n.init=function(){},n.loop=function(){F.e=0!==n.t.s?a()-n.t.s:0,n.update(),n.t.s=a(),n.ex||raf(n.loop.bind(n))},n.exit=function(){n.ex=1},n.reset()},I=function(){var i=this;i.e=[],i.add=function(n){i.e.push(n)},i.c=function(n,t){var e,r;for(e=i.e.length;e--;)r=i.e[e],F.cam.inView(r)&&F.o.rect(n,r)&&t(n,r)},i.u=function(){var n,t,e=[];for(n=i.e.length;n--;)(t=i.e[n]).hasOwnProperty("u")&&t.u(),t.a||e.push(n);0<e.length&&(i.e=i.e.filter(function(n,t){return e.indexOf(t)<0}))},i.r=function(){F.cam.r(i.e)},i.clr=function(){i.e=[]}},S=function(n,t,e,r){var i=this;i.x=n,i.y=t,i.w=e,i.h=r,i.a=1,i.b={},i.updateRect=function(){i.b={b:i.y+i.h,t:i.y,l:i.x,r:i.x+i.w}},i.updateRect()},D=function(){var r=this;r.rect=function(n,t){return 0!==Object.keys(n.b).length&&0!==Object.keys(t.b).length&&!(n.b.b<t.b.t||n.b.t>t.b.b||n.b.l>t.b.r||n.b.r<t.b.l)},r.faces=function(n,t){return{t:an(n.b.b-t.b.t),b:an(n.b.t-t.b.b),l:an(n.b.r-t.b.l),r:an(n.b.l-t.b.r)}},r.bottom=function(n,t){var e=r.faces(n,t);return e.t<e.b&&e.t<e.l&&e.t<e.r},r.top=function(n,t){var e=r.faces(n,t);return e.b<e.t&&e.b<e.l&&e.b<e.r},r.right=function(n,t){var e=r.faces(n,t);return e.l<e.b&&e.l<e.t&&e.l<e.r},r.left=function(n,t){var e=r.faces(n,t);return e.r<e.b&&e.r<e.l&&e.r<e.t}},R=function(n,t,e){var r=this;r.arr=n,r.d=t||150,r.c=0,r.f=e||0,r.cb=0,r.u=function(){r.c+=F.e,r.c>r.d&&(r.c=0,r.f+=1,r.f=r.f>r.arr.length-1?0:r.f,r.cb&&r.cb(r.f))},r.g=function(){return r.arr[r.f]}};function N(){this.setSettings=function(n){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=n[t]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var r=.18/e;this.b*=r,this.c*=r,this.e*=r}}}function G(){var q,Y,X,Z,J,K,Q,$,nn,tn,en,rn;this._params=new N,this.reset=function(){var n=this._params;Z=100/(n.f*n.f+.001),J=100/(n.g*n.g+.001),K=1-n.h*n.h*n.h*.01,Q=-n.i*n.i*n.i*1e-6,n.a||(en=.5-n.n/2,rn=5e-5*-n.o),$=1+n.l*n.l*(0<n.l?-.9:10),nn=0,tn=1==n.m?0:(1-n.m)*(1-n.m)*2e4+32},this.totalReset=function(){this.reset();var n=this._params;return q=n.b*n.b*1e5,Y=n.c*n.c*1e5,X=n.e*n.e*1e5+12,3*((q+Y+X)/3|0)},this.synthWave=function(n,t){var e=this._params,r=1!=e.s||e.v,i=e.v*e.v*.1,a=1+3e-4*e.w,c=e.s*e.s*e.s*.1,f=1+1e-4*e.t,s=1!=e.s,o=e.x*e.x,x=e.g,u=e.q||e.r,l=e.r*e.r*e.r*.2,h=e.q*e.q*(e.q<0?-1020:1020),d=e.p?32+((1-e.p)*(1-e.p)*2e4|0):0,w=e.d,m=e.j/2,y=e.k*e.k*.01,p=e.a,v=q,g=1/q,b=1/Y,I=1/X,S=5/(1+e.u*e.u*20)*(.01+c);.8<S&&(S=.8),S=1-S;for(var D,R,N,G,k,E,W=!1,C=0,A=0,T=0,z=0,P=0,F=0,L=0,M=0,H=0,O=0,j=new Array(1024),B=new Array(32),U=j.length;U--;)j[U]=0;for(U=B.length;U--;)B[U]=2*fn()-1;for(U=0;U<t;U++){if(W)return U;if(d&&++H>=d&&(H=0,this.reset()),tn&&++nn>=tn&&(tn=0,Z*=$),J<(Z*=K+=Q)&&(Z=J,0<x&&(W=!0)),R=Z,0<m&&(R*=1+cn(O+=y)*m),(R|=0)<8&&(R=8),p||((en+=rn)<0?en=0:.5<en&&(en=.5)),++A>v)switch(A=0,++C){case 1:v=Y;break;case 2:v=X}switch(C){case 0:T=A*g;break;case 1:T=1+2*(1-A*b)*w;break;case 2:T=1-A*I;break;case 3:W=!(T=0)}u&&((N=0|(h+=l))<0?N=-N:1023<N&&(N=1023)),r&&a&&((i*=a)<1e-5?i=1e-5:.1<i&&(i=.1)),E=0;for(var V=8;V--;){if(R<=++L&&(L%=R,3==p))for(var _=B.length;_--;)B[_]=2*fn()-1;switch(p){case 0:k=L/R<en?.5:-.5;break;case 1:k=1-L/R*2;break;case 2:k=.225*(((k=1.27323954*(G=6.28318531*(.5<(G=L/R)?G-1:G))+.405284735*G*G*(G<0?1:-1))<0?-1:1)*k*k-k)+k;break;case 3:k=B[an(32*L/R|0)]}r&&(D=F,(c*=f)<0?c=0:.1<c&&(c=.1),s?(P+=(k-F)*c,P*=S):(F=k,P=0),z+=(F+=P)-D,k=z*=1-i),u&&(j[M%1024]=k,k+=j[(M-N+1024)%1024],M++),E+=k}E*=.125*T*o,n[U]=1<=E?32767:E<=-1?-32768:32767*E|0}return t}}var k=new G;window.jsfxr=function(n){k._params.setSettings(n);var t=k.totalReset(),e=new Uint8Array(4*((t+1)/2|0)+44),r=2*k.synthWave(new Uint16Array(e.buffer,44),t),i=new Uint32Array(e.buffer,0,44);i[0]=1179011410,i[1]=r+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=r,r+=44;for(var a=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="data:audio/wav;base64,";a<r;a+=3){var s=e[a]<<16|e[a+1]<<8|e[a+2];f+=c[s>>18]+c[s>>12&63]+c[s>>6&63]+c[63&s]}return f};var E=function(){var r=this;r.s={},r.a=function(n,t,e){e=e||1,r.s[n]=new W(t,e)},r.p=function(n){r.s.hasOwnProperty(n)&&r.s[n].p()}},W=function(n,t){var e=this;e.c=[];for(var r=t;r--;)e.c.push(new C(n));e.p=function(){for(var n=e.c.length;n--;)if(!e.c[n].b){e.c[n].p();break}}},C=function(n){var t=this;t.b=0,t.a=new Audio,t.a.src=jsfxr(n),t.a.addEventListener("playing",function(){t.b=1}),t.a.addEventListener("ended",function(){t.b=0}),t.p=function(){t.a.play().then(function(n){}).catch(function(n){})}},A=function(n,t,e,r){var i=this;i.x=n,i.y=t,i.w=e,i.h=r,i.update=function(){i.b={b:i.y+i.h,t:i.y,l:i.x,r:i.x+i.w}},i.toGrid=function(){return new A(c(i.x/GS),c(i.y/GS),i.w/GS,i.h/GS)},i.center=function(){return new T(i.x+i.w/2,i.y+i.h/2)},i.update()};A.fromGrid=function(n){return new A(n.x*GS,n.y*GS,n.w*GS,n.h*GS)};var T=function(n,t){var e=this;e.x=n,e.y=t,e.toGrid=function(){return new T(c(e.x/GS),c(e.y/GS))}},z=function(n,t,e){var p=this;p.ww=n,p.wh=t,p.mx=e,p.getdist=function(n,t){return u(x(n.x-t.x,2)+x(n.y-t.y,2))},p.neighbors=function(n,t){var e,r,i,a,c,f,s=t-1,o=t+1,x=n+1,u=n-1,l=-1<s&&!F.lvl.isWall(n,s),h=o<p.wh&&!F.lvl.isWall(n,o),d=x<p.ww&&!F.lvl.isWall(x,t),w=-1<u&&!F.lvl.isWall(u,t),m=0,y=[];return l&&(y.push({x:n,y:s}),e=1),h&&(y.push({x:n,y:o}),i=1),d&&(y.push({x:x,y:t}),r=1),w&&(y.push({x:u,y:t}),m=1),a=e&&r,c=r&&i,f=i&&m,m&&e&&!F.lvl.isWall(u,s)&&y.push({x:u,y:s}),a&&!F.lvl.isWall(x,s)&&y.push({x:x,y:s}),c&&!F.lvl.isWall(x,o)&&y.push({x:x,y:o}),f&&!F.lvl.isWall(u,o)&&y.push({x:u,y:o}),y},p.findpath=function(n,t){for(var e,r,i,a,c,f,s,o,x=new P(null,new T(n.x,n.y).toGrid(),p.ww),u=new P(null,new T(t.x,t.y).toGrid(),p.ww),l=F.lvl.length(),h=new Array(l),d=[x],w=[],m=[];a=d.length;){for(c=l,f=-1,s=0;s<a;s++)d[s].f<c&&(c=d[s].f,f=s);if((r=d.splice(f,1)[0]).v===u.v){i=w[w.push(r)-1];do{if(m.push(new T(i.x*GS,i.y*GS)),m.length>p.mx)return[]}while(i=i.p);h=w=d=[],m.reverse()}else{for(s=0,o=(e=p.neighbors(r.x,r.y)).length;s<o;s++)h[(i=new P(r,e[s],p.ww)).v]||(i.g=r.g+p.getdist(e[s],r),i.f=r.g+p.getdist(e[s],u),d.push(i),h[i.v]=!0);w.push(r)}}return m}},P=function(n,t,e){var r=this;r.p=n,r.v=t.x+t.y*e,r.x=t.x,r.y=t.y,r.f=0,r.g=0},F={},L=!1,M=document;function H(){var n=window.innerHeight,t=n*F.cv.width/F.cv.height;F.cv.style.width=t+"px",F.cv.style.height=n+"px"}F.cv=M.querySelector("canvas"),F.init=function(n,t){F.vh=F.cv.height,F.vw=F.cv.width,F.g={},F.e=0,F.x=F.cv.getContext("2d"),F.cam=new g(F.vw,F.vh),F.x.s=F.x.save,F.x.r=F.x.restore,F.x.f=F.x.fill,F.x.k=F.x.stroke,F.x.tn=F.x.translate,F.x.ro=F.x.rotate,F.x.sr=F.x.strokeRect,F.x.cr=F.x.clearRect,F.x.mt=F.x.measureText,F.x.di=F.x.drawImage,F.x.sc=F.x.scale,F.x.bp=F.x.beginPath,F.x.cp=F.x.closePath,F.x.mv=F.x.moveTo,F.x.lt=F.x.lineTo,F.x.e=F.x.ellipse,F.x.lw=function(n){F.x.lineWidth=n},F.x.fr=function(n,t,e,r){F.x.fillRect(c(n),c(t),e,r)},F.x.fs=function(n){F.x.fillStyle=n},F.x.ss=function(n){F.x.strokeStyle=n},F.x.clr=function(n){F.x.cr(0,0,F.vw,F.vh),F.x.fs(n||"#000"),F.x.fr(0,0,F.vw,F.vh)},F.x.ga=function(n){F.x.globalAlpha=n},F.x.ts=function(n,t,e,r){e=e||"serif",r=r||"",F.x.fs(t||"#000"),F.x.font=r+" "+String(n)+"px "+e},F.x.ft=function(n,t,e,r,i,a,c,f){(f=f||"l",F.x.ts(t,i,a,c),"r"===f)&&(e-=F.x.mt(n).width);F.x.fillText(n,e,r)},F.x.ct=function(n,t,e,r,i,a){F.x.ts(t,r,i,a);var c=F.x.mt(n);F.x.fillText(n,(F.vw-c.width)/2,e)}},F.byId=function(n){return M.getElementById(n)},window.addEventListener("load",H,!1),window.addEventListener("resize",H,!1),GS=64,MIN_PS=1.55,MIN_ZS=1,MAX_ZPD=15,MIN_BD=900,LIVES=3,BEAT=150,IT={A:2,M:3,S:4,F:5},IN={L:[65,81,37],R:[68,39],U:[87,90,38],D:[83,40],E:[13],T:[84]},DIR={LEFT:"l",RIGHT:"r",UP:"u",DOWN:"d"},WPN={MG:{ID:"MACHINEGUN",DL:50,SP:50,SI:10},SG:{ID:"SHOTGUN",DL:300,SP:30,SI:16},FL:{ID:"FLAME",DL:40,SP:7,SI:60}},VACC_PD=1300,DROP=.3,AMMO=10,WH="#fff",BL="#000",RD="#f00",FC="#5a5a5a",AC="#4b4e44",HC="#f3c17f",FN="sans-serif";var O=function(){var i=this;i.inherits(b),b.call(i),i.anim=new R([0,1]),i.init=function(){i.xc=0,i.de=400,i.ef=0},i.update=function(){var n,t;for(i.de=d(i.de-F.e,0),i.xc=d(i.xc-F.e,0),0===i.xc&&i.ef?(i.exit(),F.scn.game.start()):i.ef||i.anim.u(),F.x.clr(WH),F.x.ss("#f80"),F.x.bp(),F.x.lw(12),t=0;t<2;t++)for(n=0;n<20;n++)F.x.mv(1024*t-30*(t+1),30*n),F.x.lt(1024*t+60,30*(n+1));F.x.cp(),F.x.k(),F.x.fs("#f80"),F.x.fr(50,0,F.vw-100,F.vh),F.x.ct("PANDEMIA 2",125,150,WH,FN),F.x.ct("Joke's on us!",50,200,WH,FN),i.anim.g()&&F.x.ct("Press ENTER to start",35,490,WH,FN),F.x.ct("By @satanas82 for js13k 2017",15,550,"#eee",FN);var e=c(F.vw/2),r=c(F.vh/2)+40;F.x.fs(WH),i.dc(e,r-60+10,60),i.dc(e-60+10,r+30,60),i.dc(e+60-10,r+30,60),F.x.fs("#f80"),i.dc(e,r-40-30,40),i.dc(e-40-30,r+40,40),i.dc(e+40+30,r+40,40),i.dc(e,r,10),!F.in.p(IN.E)||i.ef||i.de||(i.ef=1,i.xc=300,i.anim.f=0,F.sn.p("sl"))},i.dc=function(n,t,e){F.x.bp(),F.x.arc(n,t,e,0,2*h),F.x.cp(),F.x.f()}},B=function(){var f=this;f.maxBlur=5,f.be=0,f.end=0,f.zn=0,f.tries=0,f.zk=0,f.sh=0,f.vm="delivered the vaccine to save the human race.",f.inherits(b),b.call(f),F.ss=new on,F.hud=new sn,f.init=function(){f.be=0,f.end=0,f.zk=0,f.sh=0,F.msg=0,f.zn?(Object.keys(F.g).forEach(function(n){F.g[n].clr()}),f.ww=f.wh=6144,f.tries?F.lvl.reload():F.lvl.gen(f.ww,f.wh)):(Object.keys(F.g).forEach(function(n){F.g[n].clr()}),f.ww=1024,f.wh=576,F.lvl.iroom(f.ww,f.wh)),F.cam.setWorldSize(f.ww,f.wh),F.hud.sws(f.ww,f.wh),F.cam.setTarget(F.player)},f.nz=function(){f.zn+=1,f.reset(),f.init()},f.update=function(){F.x.clr("#787878"),F.msg=0,f.be=d(f.be-F.e,0),F.g.w.u(),F.g.s.u(),F.g.z.u(),F.g.i.u(),F.g.h.u(),F.g.x.u(),F.player.u(),F.g.n.u(),F.g.b.u(),F.cam.u(),F.hud.u(),F.ss.u(),F.g.s.r(),F.g.d.r(),F.g.h.r(),F.g.w.r(),F.g.i.r(),F.g.z.r(),F.cam.r(F.player),F.g.n.r(),F.g.x.r(),F.g.b.r(),F.player.dAim(),F.hud.r(),f.fx(),f.gm(),f.zn||f.pi(),f.mod()},f.fx=function(){var n,t=F.player.hum,e=0;n=d(2*(100-t),0,100),t<=70&&0<t&&(e=d(2*(50-t),0,100)),F.cv.style.filter="grayscale("+n+"%) blur("+e*f.maxBlur/100+"px)",f.be&&(F.x.fs("rgba(255,0,0,0.4)"),F.x.fr(0,0,F.vw,F.vh))},f.pi=function(){F.x.fs("rgba(0,0,0,0.5)"),F.x.fr(300,460,430,70),F.x.ct("WASD, ZQSD and ARROWS to move",20,490,WH,FN),F.x.ct("MOUSE to aim and shoot",20,515,WH,FN)},f.over=function(){f.end||(f.end=1,F.sn.p("go"),F.lvl.ds.push(new K(F.player.x,F.player.y,{soldier:!0,render:_.d})))},f.win=function(){f.end=2,F.sn.p("wn")},f.gm=function(){F.msg&&F.x.ct(F.msg,30,200,WH,FN)},f.mod=function(){if(f.end){var n,t,e=WH,r=FN,i="play again",a=0,c=(F.vw,(F.vh-500)/2);f.rstfx(),1===f.end?(F.x.fs(BL),f.tries<LIVES?(n="YOU DIED",i="send another soldier",F.in.p(IN.E)&&(f.zn=0,f.tries+=1,f.init(),F.sn.p("sl"))):(n="GAME OVER",F.in.p(IN.E)&&f.goToMenu())):2===f.end&&(F.x.fs("#f80"),a=1,n="WELL DONE!",t="You "+f.vm,F.in.p(IN.E)&&f.goToMenu()),F.x.fr(0,0,F.vw,F.vh),F.x.ct(n,90,c+150,e,r),t&&F.x.ct(t,18,c+250,e,r),F.x.ct("Press ENTER to "+i+". T to share",20,c+450,e,r),F.in.p(IN.T)&&f.share(a)}},f.rstfx=function(){F.cv.style.filter=""},f.goToMenu=function(){F.sn.p("sl"),f.tries=0,f.zn=0,f.exit(),F.scn.menu.start()},f.share=function(n){if(!f.sh){f.sh=1;var t=document.createElement("a"),e="I killed "+f.zk+" zombie";10<f.zn&&(e+="s"),e+=n?" and "+f.vm:" but couldn't save the human race.",e+=" Try Pandemia on https://satanas.github.io/pandemia/ #js13k",t.target="_blank",t.href="https://twitter.com/intent/tweet?text="+escape(e),t.click()}}},U=function(){var c=this;c.ww=0,c.wh=0,c.map=[],c.bkmap=[],c.leafs=[],c.root=null,c.maxLeafSize=20,c.pcoord=0,c.os=new A(0,0,0,0),c.iroom=function(n,t){var e=0,r=0;for(c.ww=n/GS,c.wh=t/GS,r=0;r<c.wh;r++)for(c.map[r]=[],e=0;e<c.ww;e++)if(0===r||r===c.wh-1||0===e||e===c.ww-1){if(3<=r&&r<=5&&15===e){F.scn.game.tries||F.g.w.add(new Z((e-1)*GS,r*GS));continue}c.map[r][e]="#",F.g.w.add(new X(e*GS,r*GS))}else c.map[r][e]=".",F.g.d.add(new J(e*GS,r*GS));for(F.g.h.add(new ln(970,202)),F.player=new _(640,320,{render:K.d}),F.scientist=new q(320,320),F.g.n.add(F.scientist),F.g.h.add(new dn(256,256)),F.scn.game.tries||F.g.x.add(new rn(128,128)),e=0;e<LIVES-F.scn.game.tries;e++)F.g.n.add(new Y(378+100*e,110))},c.gen=function(n,t){var e=0,r=0;for(c.ww=n/GS,c.wh=t/GS,c.os.w=c.ww,c.os.h=c.wh,c.arooms=[],c.srooms=[],c.ds=[],c.makeLeafs(),c.root.createRooms(),r=0;r<c.wh;r++)for(c.map[r]=[],e=0;e<c.ww;e++)c.map[r][e]="#";for(c.leafs.forEach(function(n){var t=n.room;if(null!==t)for(c.arooms.push(A.fromGrid(t)),r=t.y;r<t.y+t.h;r++)for(e=t.x;e<t.x+t.w;e++)c.map[r][e]=".",F.g.d.add(new J(e*GS,r*GS));n.halls.forEach(function(n){if(null!=n)for(r=n.y;r<n.y+n.h;r++)for(e=n.x;e<n.x+n.w;e++)c.map[r][e]=".",F.g.d.add(new J(e*GS,r*GS))})}),r=0;r<c.wh;r++)for(e=0;e<c.ww;e++)c.isWall(e,r)&&F.g.w.add(new X(e*GS,r*GS));var i,a=[];for(e=w(0,c.arooms.length),i=c.arooms[e].center(),F.vaccine=new rn(i.x,i.y),F.g.x.add(F.vaccine),c.pcoord=new T(i.x,i.y),F.player.reset(i.x,i.y),a.push(e);(r=w(0,c.arooms.length))===e||c.getdist(i,c.arooms[r])<=2*c.ww/3*GS;);for(i=c.arooms[r].center(),F.endzone=new hn(i.x,i.y),F.g.h.add(F.endzone),e=0;e<c.arooms.length;e++)-1===a.indexOf(e)&&(c.addSpawner(c.arooms[e]),c.srooms.push(c.arooms[e]));c.bkmap=c.map.slice(0)},c.reload=function(){for(c.map=c.bkmap.slice(0),c.ww=c.os.w,c.wh=c.os.h,c.ds=c.ds.filter(function(n){return n.a&&(n.rst(),F.g.z.add(n)),n.a}),F.g.h.add(F.endzone),F.g.x.add(F.vaccine),F.player.reset(c.pcoord.x,c.pcoord.y),j=0;j<c.wh;j++)for(i=0;i<c.ww;i++){var n=c.map[j][i];"#"===n?F.g.w.add(new X(i*GS,j*GS)):"."===n&&F.g.d.add(new J(i*GS,j*GS))}for(i=0;i<c.srooms.length;i++)F.g.s.add(new Q(c.srooms[i]))},c.isWall=function(n,t){return"#"===c.map[t][n]},c.getWorldSize=function(){return new A(0,0,c.ww*GS,c.wh*GS)},c.length=function(){return c.ww*c.wh},c.addSpawner=function(n){var t=new Q(n),e=new A(t.x,t.y,t.w,t.h).toGrid();for(F.g.s.add(t),j=e.y;j<e.b.b;j++)for(i=e.x;i<e.b.r;i++)c.map[j][i]="s"},c.makeLeafs=function(){var n=!0;for(c.root=new V(0,0,c.ww,c.wh),c.leafs.push(c.root);n;){n=!1;for(var t=0;t<c.leafs.length;t++){var e=c.leafs[t];null===e.lc&&null===e.rc&&(e.w>c.maxLeafSize||e.h>c.maxLeafSize||.25<fn())&&e.split()&&(c.leafs.push(e.lc),c.leafs.push(e.rc),n=!0)}}},c.print=function(){var n,t,e;for(n=0;n<c.wh;n++)for(e=[],t=0;t<c.ww;t++)e.push(c.map[n][t])},c.getdist=function(n,t){return u(x(n.x-t.x,2)+x(n.y-t.y,2))}},V=function(n,t,e,r){var f=this;f.x=n,f.y=t,f.w=e,f.h=r,f.lc=null,f.rc=null,f.min=10,f.room=null,f.halls=[],f.split=function(){if(f.lc||f.rc)return 0;var n=!!w(0,2);f.w>f.h&&1.25<=f.w/f.h?n=0:f.h>f.w&&1.25<=f.h/f.w&&(n=1);var t=(n?f.h:f.w)-f.min;if(t<=f.min)return 0;var e=w(f.min,t+1);return n?(f.lc=new V(f.x,f.y,f.w,e),f.rc=new V(f.x,f.y+e,f.w,f.h-e)):(f.lc=new V(f.x,f.y,e,f.h),f.rc=new V(f.x+e,f.y,f.w-e,f.h)),1},f.createRooms=function(){if(null!==f.lc||null!==f.rc)null!==f.lc&&f.lc.createRooms(),null!==f.rc&&f.rc.createRooms(),null!==f.lc&&null!==f.rc&&f.createHall(f.lc.getRoom(),f.rc.getRoom());else{var n=w(5,f.w-2),t=w(5,f.h-2),e=w(1,f.w-n-1),r=w(1,f.h-t-1);f.room=new A(f.x+e,f.y+r,n,t)}},f.getRoom=function(){return f.room?f.room:(f.lc&&(n=f.lc.getRoom()),f.rc&&(t=f.rc.getRoom()),n||t?t?n&&.5<fn()?n:t:n:null);var n,t},f.createHall=function(n,t){var e=new T(w(n.b.l+1,n.b.r-2),w(n.b.t+1,n.b.b-2)),r=new T(w(t.b.l+1,t.b.r-2),w(t.b.t+1,t.b.b-2)),i=r.x-e.x,a=r.y-e.y;function c(n,t,e,r){f.halls.push(new A(n,t,e,r))}i<0?a<0?fn()<.5?(c(r.x,e.y,an(i),3),c(r.x,r.y,3,an(a))):(c(r.x,r.y,an(i),3),c(e.x,r.y,3,an(a))):0<a?fn()<.5?(c(r.x,e.y,an(i),3),c(r.x,e.y,3,an(a))):(c(r.x,r.y,an(i),3),c(e.x,e.y,3,an(a))):c(r.x,r.y,an(i),3):0<i?a<0?fn()<.5?(c(e.x,r.y,an(i),3),c(e.x,r.y,3,an(a))):(c(e.x,e.y,an(i),3),c(r.x,r.y,3,an(a))):0<a?fn()<.5?(c(e.x,e.y,an(i),3),c(r.x,e.y,3,an(a))):(c(e.x,r.y,an(i),3),c(e.x,e.y,3,an(a))):c(e.x,e.y,an(i),3):a<0?c(r.x,r.y,3,an(a)):0<a&&c(e.x,e.y,3,an(a))}},_=function(n,t,e){var i=this;i.mxs=0,i.d=DIR.LEFT,i.s=.35,i.dx=0,i.dy=0,i.ic=0,i.hum=100,i.hd=i.hum/420,i.vaccine=0,i.an=0,i.ammo=500,i.hf=0,i.hc=i.hf,i.bd=BEAT,i.bc=0,i.aim=new T(0,0),i.wpn=WPN.MG,i.anim=new R([0,1]),i.render=e.render,i.inherits(S),S.call(i,n,t,64,64),i.u=function(){0===F.scn.game.end&&(i.hum=d(i.hum-F.e*i.hd/1e3,.1),i.mxs=d(i.hum/10-1.5,MIN_PS),i.sd=d(i.sd-F.e,0),i.ic=d(i.ic-F.e,0),i.hc=d(i.hc-F.e,0),i.bd=d(i.bd-F.e,0),i.hf=10*i.hum,i.anim.u(),F.in.p(IN.L)?(i.d=DIR.LEFT,i.dx-=i.s):F.in.p(IN.R)&&(i.d=DIR.RIGHT,i.dx+=i.s),F.in.p(IN.U)?(i.d=DIR.UP,i.dy-=i.s):F.in.p(IN.D)&&(i.d=DIR.DOWN,i.dy+=i.s),i.dx=d(i.dx,-i.mxs,i.mxs),i.dy=d(i.dy,-i.mxs,i.mxs),F.in.p(IN.L)||F.in.p(IN.R)||(i.dx=0),F.in.p(IN.U)||F.in.p(IN.D)||(i.dy=0),i.x+=i.dx,i.y+=i.dy,i.x=d(i.x,0,F.cam.ww-i.w),i.y=d(i.y,0,F.cam.wh-i.h),i.updateRect(),F.g.w.c(i,function(n,t){F.o.top(n,t)?n.y=t.b.b:F.o.bottom(n,t)&&(n.y=t.b.t-n.h),F.o.left(n,t)?n.x=t.b.r:F.o.right(n,t)&&(n.x=t.b.l-n.w)}),F.g.z.c(i,function(n,t){0===i.ic&&(i.hum=d(i.hum-t.bite(),0),i.ic=300,i.drop(),F.scn.game.be=30,F.ss.shake(4,200),F.sn.p("ph"),i.hum<=0&&(F.scn.game.over(),F.sn.p("fp")))}),F.g.i.c(i,function(n,t){t.a=0,F.sn.p("it"),t.t===IT.A?i.ammo+=AMMO:t.t===IT.M?i.wpn=WPN.MG:t.t===IT.S?i.wpn=WPN.SG:t.t===IT.F&&(i.wpn=WPN.FL)}),i.vaccine||F.g.x.c(i,function(n,t){t.isPickable()&&(F.sn.p("vp"),t.pick(),i.vaccine=t);var e=F.scientist;1===e.st&&e.n()}),i.vaccine&&(i.vaccine.x=i.x+16,i.vaccine.y=i.y),F.g.h.c(i,function(n,t){if(t.end&&i.vaccine&&!t.o)F.scn.game.win();else if(t.intro){if(F.scn.game.tries)return;var e=F.scientist;0===e.st&&e.n()}else t.start&&(F.scn.game.tries?F.scn.game.nz():i.vaccine?F.scn.game.nz():t.al())}),i.hc||(i.bc<2?i.bd||(i.bd=BEAT,i.bc+=1,F.sn.p("hb")):(i.bc=0,i.bd=BEAT,i.hc=i.hf)),i.updateRect(),i.shooting&&!i.sd&&i.shoot())},i.r=function(n){var t=!(!i.dx&&!i.dy);i.render(n.x,n.y,i.d,t,i.anim,{vaccine:i.vaccine,sol:!0})},i.shoot=function(){if(!(i.ammo<=0)){i.drop(),i.sd=i.wpn.DL;var n,t=i.getCenter();if(i.ammo-=1,F.g.b.add(new xn(t.x,t.y,i.an,i.wpn)),i.wpn.ID===WPN.SG.ID){for(n=4;n--;)F.g.b.add(new xn(t.x,t.y,i.an+w(4,15)*h/180,i.wpn)),i.ammo=d(i.ammo-1,0);F.sn.p("sh")}else i.wpn.ID===WPN.FL.ID?F.sn.p("fl"):F.sn.p("gu")}},i.reset=function(n,t){i.x=n,i.y=t,i.vaccine=0},i.drop=function(){i.vaccine&&(i.vaccine.drop(i),i.vaccine=0)},i.getCenter=function(){return new T(i.x+i.w/2,i.y+i.h/2)},i.offc=function(n){return new T(n.x+i.w*i.scaleX/2,n.y+i.h*i.scaleY/2)},i.uAim=function(n){var t=F.cv.getBoundingClientRect(),e=F.cam.txPCoord(i.x,i.y),r=i.offc(e);i.scaleX=F.cv.width/t.width,i.scaleY=F.cv.height/t.height,i.aim.x=(n.clientX-t.left)*i.scaleX,i.aim.y=(n.clientY-t.top)*i.scaleY,i.an=s(i.aim.y-r.y,i.aim.x-r.x)},i.dAim=function(){F.x.fs(RD),F.x.bp(),F.x.arc(i.aim.x,i.aim.y,2,0,2*h),F.x.cp(),F.x.f(),F.x.fr(i.aim.x-2,i.aim.y-18,5,12),F.x.fr(i.aim.x-2,i.aim.y+7,5,12),F.x.fr(i.aim.x-18,i.aim.y-2,12,5),F.x.fr(i.aim.x+7,i.aim.y-2,12,5)},F.cv.addEventListener("mousemove",function(n){i.uAim(n)},!1),F.cv.addEventListener("mousedown",function(n){i.shooting=1}),F.cv.addEventListener("mouseup",function(n){i.shooting=0})};_.d=function(n,t,e,r,i,a){e===DIR.UP&&(a.vaccine?rn.d(n+16,t-6):(F.x.fs(HC),F.x.fr(n+9,t+44,7,5),F.x.fr(n+50,t+44,7,5))),F.x.fs("#ffca85"),F.x.fr(n+2,t,62,38),F.x.fs("#727254"),F.x.fr(n+16,t+38,34,13),F.x.fs("#203622"),F.x.fr(n+16,t+50,34,5),r?i.g()?F.x.fr(n+16,t+55,14,8):i.g()||F.x.fr(n+36,t+55,14,8):(F.x.fr(n+16,t+55,14,8),F.x.fr(n+36,t+55,14,8)),e!==DIR.UP&&e!==DIR.DOWN||(F.x.fs(AC),F.x.fr(n+9,t+39,7,5),F.x.fr(n+50,t+39,7,5)),F.x.fs(RD),F.x.fr(n+2,t+5,62,4),e===DIR.UP?(F.x.ss(RD),F.x.lw(3),F.x.bp(),F.x.mv(n+20,t+20),F.x.lt(n+32,t+8),F.x.lt(n+42,t+20),F.x.k()):e===DIR.DOWN?(F.x.fs(HC),F.x.fr(n+9,t+44,7,5),F.x.fr(n+50,t+44,7,5),F.x.fs(FC),F.x.fr(n+15,t+19,6,6),F.x.fr(n+45,t+19,6,6),F.x.fr(n+27,t+31,12,2),a.vaccine&&rn.d(n+16,t+16)):e===DIR.LEFT?(F.x.fs(AC),F.x.fr(n+11,t+40,16,7),F.x.fs(HC),F.x.fr(n+5,t+40,6,7),a.vaccine&&rn.d(n-30,t+16),F.x.fs(FC),F.x.fr(n+10,t+19,6,6),F.x.fr(n+4,t+31,4,2)):e===DIR.RIGHT&&(F.x.fs(AC),F.x.fr(n+39,t+40,16,7),F.x.fs(HC),F.x.fr(n+55,t+40,6,7),a.vaccine&&rn.d(n+62,t+16),F.x.fs(FC),F.x.fr(n+50,t+19,6,6),F.x.fr(n+58,t+31,4,2))};var q=function(n,t){var a=this;a.anim=new R([0,1]),a.st=0,a.ba=1,a.fda=[["Soldier, come here. I need your..."],["the safe zone. So, pick it up...","human race delivering the vaccine to","are all infected. But we can save the","... you smell funny. Anyways, we"],["the vaccine before you lose your humanity.","Now blow up the barricade and deliver"]],a.sda=[["take it to the safe zone.","Go suspicious soldier! Retrieve the vaccine and"]],a.dg=F.scn.game.tries?a.sda:a.fda,a.inherits(S),S.call(a,n,t,64,64),a.u=function(){a.anim.u()},a.r=function(n){var t,e=WH,r=FN,i="#c68642";for(F.x.fs(i),F.x.fr(n.x+2,n.y,62,38),F.x.fs(e),F.x.fr(n.x+16,n.y+38,34,13),F.x.fr(n.x+16,n.y+50,34,5),F.x.fs("#2196f3"),F.x.fr(n.x+43,n.y+38,7,18),F.x.fs("#333"),F.x.fr(n.x+16,n.y+55,14,8),F.x.fr(n.x+36,n.y+55,14,8),F.x.fs("#ededed"),F.x.fr(n.x+30,n.y+40,7,16),F.x.fs(i),F.x.fr(n.x+30,n.y+51,6,7),F.x.fs(FC),F.x.fr(n.x+50,n.y+19,6,6),F.x.fr(n.x+58,n.y+31,4,2),F.x.ss(e),F.x.bp(),F.x.mv(n.x-64,n.y-20),F.x.lt(n.x+128,n.y-20),F.x.mv(n.x+42,n.y),F.x.lt(n.x+5,n.y-20),F.x.cp(),F.x.k(),t=0;t<a.dg[a.st].length;t++)F.x.ft(a.dg[a.st][t],16,250,280-20*t,e,r);1===a.st&&a.anim.g()?F.x.ft("VACCINE",16,110,180,e,r):2===a.st&&a.anim.g()&&a.ba&&F.x.ft("BARRICADE",16,880,300,e,r)},a.n=function(){a.st+=1}},Y=function(n,t){this.inherits(S),S.call(this,n,t,64,64),this.r=function(n,t,e){F.x.fs("#ffca85"),F.x.fr(t+2,e,62,38),F.x.fs("#727254"),F.x.fr(t+16,e+38,34,13),F.x.fs("#203622"),F.x.fr(t+16,e+50,34,5),F.x.fr(t+16,e+55,14,8),F.x.fr(t+36,e+55,14,8),F.x.fs(AC),F.x.fr(t+9,e+39,7,5),F.x.fr(t+50,e+39,7,5),F.x.fs(HC),F.x.fr(t+9,e+44,7,5),F.x.fr(t+50,e+44,7,5),F.x.fs(FC),F.x.fr(t+15,e+19,6,6),F.x.fr(t+45,e+19,6,6),F.x.fr(t+27,e+31,12,2)}},X=function(n,t){var e=this;e.inherits(S),S.call(e,n,t,GS,GS),e.r=function(n){F.x.lw(1),F.x.fs("#c2c2c2"),F.x.ss("#949494"),F.x.fr(n.x,n.y,e.w,e.h),F.x.sr(n.x,n.y,e.w,e.h)}},Z=function(n,t){var e=this;e.health=w(4,6),e.inherits(S),S.call(e,n,t,GS,GS),e.u=function(){F.g.b.c(e,function(n,t){e.health-=1,e.health<=0&&(F.g.n.add(new un(e.x,e.y)),e.a=0,F.scientist.ba=0,F.sn.p("ex"),F.ss.shake(2,100))})},e.r=function(n){F.x.lw(1);for(var t=0;t<3;t++)F.x.fs("#8d5524"),F.x.fr(n.x,n.y,e.w,e.h),F.x.ss("#522900"),F.x.bp(),F.x.mv(n.x,n.y),F.x.lt(n.x+64,n.y),F.x.mv(n.x,n.y+21),F.x.lt(n.x+64,n.y+21),F.x.mv(n.x,n.y+44),F.x.lt(n.x+64,n.y+44),F.x.cp(),F.x.k()}},J=function(n,t){var e=this;e.inherits(S),S.call(e,n,t,64,64),e.r=function(n){F.x.lw(1),F.x.fs("#787878"),F.x.ss("#696969"),F.x.fr(n.x,n.y,e.w,e.h),F.x.sr(n.x,n.y,e.w,e.h),F.x.bp(),F.x.mv(n.x,n.y+32),F.x.lt(n.x+64,n.y+32),F.x.mv(n.x+32,n.y),F.x.lt(n.x+32,n.y+64),F.x.cp(),F.x.k()}},K=function(n,t,e){var c=this;c.mindist=500,c.path=[],c.ctimer=300,c.cc=0,c.an=0,c.tp=0,c.bc=0,c.s=fn()+MIN_ZS,c.hsc=0,c.gc=w(0,4e3),c.d="d",c.anim=new R([0,1]),c.sol=e&&e.soldier,c.health=e.solder?50:w(3,5),c.or=new T(n,t),c.render=e.render,c.inherits(S),c.inherits(z),S.call(c,n,t,64,64),z.call(c,F.lvl.ww,F.lvl.wh),c.rst=function(){c.x=c.or.x,c.y=c.or.y,c.health=50},c.u=function(){if(2!==F.scn.game.end){c.cc+=F.e,c.hsc=d(c.hsc-F.e,0),c.gc=d(c.gc-F.e,0),c.bc=d(c.bc-F.e,0),!c.gc&&.98<fn()&&c.tp&&(F.sn.p("zg"),c.gc=w(1e3,4e3));var n=c.getdist(c,F.player);if(!c.bc)if(0===c.path.length)n<=c.mindist&&40<l(n)&&(c.path=c.findpath(c,F.player,MAX_ZPD),c.tp=new T(F.player.x,F.player.y));else{if(n>c.mindist)return c.tp=null,void(c.path=[]);var t,e,r,i=c.path[0],a=c.getdist(c,i);c.anim.u(),0===a?c.path.shift():(c.an=s(i.y-c.y,i.x-c.x),e=(t=o(a,c.s))*f(c.an),r=t*cn(c.an),an(e)>an(r)?c.d=e<0?DIR.LEFT:DIR.RIGHT:c.d=r<0?DIR.UP:DIR.DOWN,c.x+=e,c.y+=r,c.updateRect(),c.cc>=c.ctimer&&null!==c.tp&&(F.player.x!==c.tp.x||F.player.y!==c.tp.y)&&c.clrPath())}F.g.b.c(c,function(n,t){if(t.type!==WPN.FL.ID&&(t.a=0),c.health-=1,c.health<=0){if(F.sn.p("zd"),F.scn.game.zk+=1,c.a=0,F.g.n.add(new un(c.x,c.y)),fn()>=DROP){var e=w(3,6),r=c.x,i=c.y;fn()<=.8?F.g.i.add(new $(r,i)):e===IT.M?F.g.i.add(new nn(r,i)):e===IT.S?F.g.i.add(new tn(r,i)):e===IT.F&&F.g.i.add(new en(r,i))}}else c.hsc||(F.sn.p("zh"),c.hsc=700)}),F.g.h.c(c,function(n,t){t.end&&t.occ()})}},c.r=function(n){c.render(n.x,n.y,c.d,!!c.tp,c.anim,{sol:c.sol})},c.bite=function(){return c.bc=w(MIN_BD,MIN_BD+200),w(4,8)},c.clrPath=function(){c.path.splice(1,c.path.length),c.cc=0}};K.d=function(n,t,e,r,i,a){var c,f,s,o,x;o="#84ae8d",a.sol?(x="#607d8b",c="#727254",f="#203622",s=AC):(x="#a0d6ab",c="#83bd90",f="#8b938d",s="#8ecc9b"),e===DIR.UP&&a.vaccine&&rn.d(n+16,t-6),F.x.fs(x),F.x.fr(n+2,t,62,38),F.x.fs(c),F.x.fr(n+16,t+38,34,13),F.x.fs(f),F.x.fr(n+16,t+50,34,5),r?i&&(i.g()?F.x.fr(n+16,t+55,14,8):F.x.fr(n+36,t+55,14,8)):(F.x.fr(n+16,t+55,14,8),F.x.fr(n+36,t+55,14,8)),e===DIR.UP?(F.x.fs(s),F.x.fr(n+9,t+39,7,5),F.x.fr(n+50,t+39,7,5)):e===DIR.DOWN?(F.x.fs(s),F.x.fr(n+9,t+39,7,10),F.x.fr(n+50,t+39,7,10),F.x.fs(o),F.x.fr(n+9,t+49,7,5),F.x.fr(n+50,t+49,7,5),F.x.fs(FC),F.x.fr(n+15,t+19,6,6),F.x.fr(n+45,t+19,6,6),F.x.fr(n+32,t+26,2,9),F.x.fr(n+27,t+31,12,2),a.vaccine&&rn.d(n+16,t+16)):e===DIR.LEFT?(F.x.fs(s),F.x.fr(n+11,t+40,16,7),F.x.fs(o),F.x.fr(n+5,t+40,6,7),a.vaccine&&rn.d(n-30,t+16),F.x.fs(FC),F.x.fr(n+10,t+19,6,6),F.x.fr(n+2,t+26,2,9),F.x.fr(n+4,t+31,4,2)):e===DIR.RIGHT&&(F.x.fs(s),F.x.fr(n+39,t+40,16,7),F.x.fs(o),F.x.fr(n+55,t+40,6,7),a.vaccine&&rn.d(n+62,t+16),F.x.fs(FC),F.x.fr(n+50,t+19,6,6),F.x.fr(n+62,t+26,2,9),F.x.fr(n+58,t+31,4,2))};var Q=function(n){var a=this;a.ro=n,a.ad=1e3,a.z=[],a.c=0,a.inherits(S),S.call(a,a.ro.x,a.ro.y,64,64),a.u=function(){var n,t=u(x(a.x-F.player.x,2)+x(a.y-F.player.y,2)),e=c(w(a.ro.x,a.ro.x+a.ro.w-32)),r=c(w(a.ro.y,a.ro.y+a.ro.h-32)),i=t<=a.ad||F.o.rect(F.player,a.ro);a.c||i?i||(a.c=d(a.c-F.e,0)):(n=new K(e,r,{render:_.d}),a.z.push(n),F.g.z.add(n),20<=a.z.length&&(a.c=8e3)),a.z=a.z.filter(function(n){return n.a})},a.r=function(n){}},$=function(n,t){this.t=IT.A,this.inherits(S),S.call(this,n,t,32,32),this.r=function(n){$.d(n.x,n.y)}};$.d=function(n,t){F.x.fs("#f6de88"),F.x.fr(n,t,32,6),F.x.fs("#f2c010"),F.x.fr(n,t+6,32,6),F.x.fs("#9b4a0e"),F.x.fr(n,t+12,32,20),F.x.fs("#571a08"),F.x.fr(n+7,t,6,32),F.x.fr(n+20,t,6,32),F.x.fs("#121212"),F.x.fr(n,t+27,32,5)};var nn=function(n,t){this.t=IT.M,this.inherits(S),S.call(this,n,t,32,32),this.r=function(n){nn.d(n.x,n.y)}};nn.d=function(n,t){F.x.fs(FC),F.x.fr(n+8,t+14,51,9),F.x.fs("#2b2b2b"),F.x.fr(n,t+23,64,6),F.x.fr(n,t+28,4,4),F.x.fr(n+8,t+28,51,4),F.x.fr(n+12,t+32,42,4),F.x.fr(n+20,t+36,4,4),F.x.fr(n+8,t+36,11,8),F.x.fr(n+4,t+40,11,8),F.x.fr(n+28,t+36,10,21),F.x.fr(n+46,t+36,8,14),F.x.fr(n+12,t+10,8,4),F.x.fr(n+52,t+10,4,4)};var tn=function(n,t){this.t=IT.S,this.inherits(S),S.call(this,n,t,32,32),this.r=function(n){tn.d(n.x,n.y)}};tn.d=function(n,t){F.x.fs("#9e9e9e"),F.x.fr(n+12,t+19,52,8),F.x.fr(n+57,t+11,4,8),F.x.fs(FC),F.x.fr(n+12,t+27,52,8),F.x.fs("#795548"),F.x.fr(n,t+31,8,24),F.x.fr(n+4,t+27,8,24),F.x.fr(n+12,t+35,35,8)};var en=function(n,t){this.t=IT.F,this.inherits(S),S.call(this,n,t,64,64),this.r=function(n){en.d(n.x,n.y)}};en.d=function(n,t){F.x.fs("#f44336"),F.x.fr(n+10,t+13,30,10),F.x.fs("#ffeb3b"),F.x.fr(n+40,t+13,4,10),F.x.fs(BL),F.x.fr(n,t+18,4,23),F.x.fr(n,t+22,64,4),F.x.fr(n+11,t+18,21,4),F.x.fr(n,t+26,45,6),F.x.fr(n+5,t+32,5,17),F.x.fr(n+10,t+32,7,4),F.x.fr(n+8,t+44,7,9),F.x.fr(n+15,t+44,10,3),F.x.fr(n+21,t+32,4,12)};var rn=function(n,t){var e=this;e.pk=0,e.anim=new R([0,1]),e.pd=0,e.inherits(S),S.call(e,n,t,32,32),e.u=function(){e.anim.u(),e.pd=d(e.pd-F.e,0),e.updateRect()},e.r=function(n){e.pk||(0<e.pd&&e.anim.g()?(F.x.fs(RD),F.x.fr(n.x,n.y,e.w,e.h)):rn.d(n.x,n.y))},e.isPickable=function(){return!e.pd},e.pick=function(){e.pk=1},e.drop=function(n){e.pk=0,F.sn.p("vd"),e.pd=VACC_PD,e.x=n.x+16,e.y=n.b.b-32}};rn.d=function(n,t,e){F.x.fs("#3f51b5"),F.x.fr(n,t,32,32),F.x.fs("#4caf50"),F.x.fr(n+13,t+6,7,19),F.x.fs("#9e9e9e"),F.x.fr(n+11,t+1,10,2),F.x.fr(n+15,t+3,3,3),F.x.fr(n+9,t+8,14,2),F.x.fr(n+16,t+26,1,6)};var sn=function(){var a=this;a.bmx=300,a.bw=a.bmx,a.mm=new A(F.vw-140,F.vh-140,120,120),a.sws=function(n,t){a.ww=n,a.wh=t},a.u=function(){a.bw=F.player.hum*a.bmx/100},a.r=function(){var n=WH,t=FN;F.x.fs("#333"),F.x.fr(50,30,a.bmx,30),F.x.fs(RD),F.x.fr(50,30,a.bw,30),F.x.ft("PATIENCE",26,60,55,n,t),$.d(670,30),F.x.ft("AMMO:",26,720,55,n,t),F.x.ft(F.player.ammo+"",26,820,55,n,t);var e,r=(F.vw-64)/2;F.x.fs("rgba(220,220,220,0.6)"),F.x.fr(r-2,14,68,68),F.x.ss(n),F.x.lw(4),F.x.sr(r-2,14,68,68),F.player.wpn.ID===WPN.MG.ID?nn.d(r,16,64,64):F.player.wpn.ID===WPN.SG.ID?tn.d(r,16,64,64):F.player.wpn.ID===WPN.FL.ID&&en.d(r,16,64,64),F.player.vaccine?(F.x.fs("rgba(0,0,0,0.8)"),F.x.fr(r,16,64,64),rn.d(r+16,32),e="VACCINE"):e=F.player.wpn.ID,F.x.ct(e,18,105,n,t);F.scn.game.zn&&(a.dc(a.mm.x+5,a.mm.y-18,"#0f0"),F.x.ft("= safe zone",11,a.mm.x+10,a.mm.y-15,n,t),a.dc(a.mm.x+5,a.mm.y-8,"#f0f"),F.x.ft("= vaccine",11,a.mm.x+10,a.mm.y-5,n,t),F.x.ga(.5),F.x.fs("#04d"),F.x.fr(a.mm.x,a.mm.y,a.mm.w,a.mm.h),F.x.ga(.7),a.rp(F.player.x,F.player.y,n),a.rp(F.endzone.x,F.endzone.y,"#0f0"),a.rp(F.vaccine.x,F.vaccine.y,"#f0f"),F.x.ga(1))},a.rp=function(n,t,e){var r=c(120*n/a.ww),i=c(120*t/a.wh);a.dc(a.mm.x+r,a.mm.y+i,e)},a.dc=function(n,t,e){F.x.fs(e),F.x.bp(),F.x.arc(n,t,2,0,2*h),F.x.cp(),F.x.f()}},on=function(){var r=this;r.elapsed=0,r.duration=0,r.magnitude=0,r.speed=20,r.perc=0,r.u=function(){if(r.duration&&r.elapsed<r.duration){r.elapsed+=F.e;var n=r.elapsed/r.duration,t=1-d(4*n-3,0,.1),e=fn()%32768*m([-1,1]);y=fn()%32768*m([-1,1]),e*=r.magnitude*t,y*=r.magnitude*t,F.cam.ofx+=e,F.cam.ofy+=y,r.elapsed>=r.duration&&(r.duration=0)}},r.shake=function(n,t){r.elapsed=0,r.perc=0,r.duration=t,r.magnitude=n}},xn=function(n,t,e,r){var i=this;i.an=e,i.type=r,i.sp=i.type.SP,i.lt=500,i.type.ID===WPN.FL.ID&&(i.an+=w(-8,8)*h/180,i.anVar=i.an+m([-20,-15,0,15,20])*h/180,i.xdecay=20,i.color=7,i.w=w(40,60)),i.inherits(S),n+=20*f(e),t+=20*cn(e),S.call(i,n,t,i.type.SI,i.type.SI),i.u=function(){i.x+=i.sp*f(i.an),i.y+=i.sp*cn(i.an),i.type.ID!==WPN.FL.ID?F.g.w.c(i,function(n,t){i.a=0}):(i.w=d(i.w-F.e*i.xdecay/1e3,1),i.lt=d(i.lt-F.e,0),i.color=d(i.color+F.e/12,7,22),i.lt<400&&i.anVar&&(i.an=i.anVar,i.anVar=0)),F.cam.inView(i)&&i.lt||(i.a=0),i.updateRect()},i.r=function(n){if(i.type.ID===WPN.FL.ID){var t=255*i.color/100,e=i.lt/200;F.x.fs("hsla("+t+",100%,50%,"+e+")")}else F.x.fs(WH);F.x.bp(),F.x.arc(n.x,n.y,i.w/2,0,2*h),F.x.cp(),F.x.f()}},un=function(n,t){var e=this;e.l=100,e.inherits(S),S.call(e,n,t,64,64),e.u=function(){e.l-=F.e,e.w=d(e.w-64*F.e/100,0),e.l<0&&(e.a=0)},e.r=function(n){F.x.fs(WH),F.x.bp(),F.x.arc(n.x+32,n.y+32,e.w,0,2*h),F.x.cp(),F.x.f()}},ln=function(n,t){var e=this;e.start=1,e.ac=0,e.inherits(S),S.call(e,n,t,54,172),e.u=function(){e.ac=d(e.ac-F.e,0),e.ac&&!F.scn.game.tries&&(F.msg="You cannot leave the lab without the vaccine")},e.r=function(n){},e.al=function(){e.ac||(e.ac=2e3)}},hn=function(n,t){var a=this;a.end=1,a.ow=256,a.oh=160,a.oc=0,a.inherits(S),S.call(a,n-64,t-40,a.ow/2,a.oh/2),a.ca=M.createElement("canvas"),a.ca.width=2*a.ow,a.ca.width=2*a.oh,a.cx=a.ca.getContext("2d"),a.lw=16,a.u=function(){a.oc=d(a.oc-F.e,0),a.oc&&(F.msg="There are zombies in the safe zone. Kill them first!")},a.r=function(n){var t,e,r=n.x-64,i=n.y-40;for(a.cx.lineWidth=1,a.cx.fillStyle=BL,a.cx.beginPath(),t=1;t<=13;t++)e=2*a.lw*t,a.cx.moveTo(0,0+e),a.cx.lineTo(0,0+e-a.lw),a.cx.lineTo(0+e-a.lw,0),a.cx.lineTo(0+e,0),a.cx.lineTo(0,0+e),a.cx.closePath();a.cx.fill(),F.x.fs("yellow"),F.x.fr(r,i,a.ow,a.oh),F.x.di(a.ca,0,0,256,160,r,i,256,160),F.x.fs(BL),F.x.fr(n.x-64,n.y+90,a.ow,30),F.x.ft("SAFE ZONE",18,n.x+10,n.y+110,WH,FN)},a.occ=function(){a.oc=1e3}},dn=function(n,t){this.intro=1,this.inherits(S),S.call(this,n,t,192,192),this.r=function(n){}};window.addEventListener("load",function(){F.init(),F.in=new v,F.o=new D,F.in.b([].concat(IN.L).concat(IN.R).concat(IN.U).concat(IN.D).concat(IN.E).concat(IN.T)),F.g.w=new I,F.g.z=new I,F.g.s=new I,F.g.i=new I,F.g.h=new I,F.g.b=new I,F.g.x=new I,F.g.n=new I,F.g.d=new I,F.lvl=new U,F.sn=new E,F.sn.a("gu",[1,,.1799,.138,.3683,.6868,.0362,-.5561,,,,,,.0728,.1995,,,,1,,,.1175,,.4],10),F.sn.a("sh",[,.001,.228,.039,.228,.418,,-.465,,,,,,.195,.0166,,,,1,,,.1804,,.5],9),F.sn.a("fl",[3,,.3554,.2783,.3645,.0744,,,,,,,,,,,,,1,,,,,.36],9),F.sn.a("ph",[,,.0209,,.1543,.344,,-.3079,,,,,,.1952,,,,,1,,,,,.5],1),F.sn.a("vd",[,,.1832,,.3385,.3446,,.2004,,,,,,.082,,.439,,,1,,,,,.3],1),F.sn.a("vp",[1,,.123,,.2337,.35,,.443,-.139,,,,,1,,.662,,,1,,,,,.4],1),F.sn.a("zh",[,,.0279,,.178,.2231,,-.3218,,,,,,.3812,,,,,1,,,,,.7],20),F.sn.a("zg",[,,.274,.011,.386,.147,,.162,-.257,,,.066,-.6916,.7262,-.2,-.8884,.016,.016,1,1,,,.016,.4],10),F.sn.a("sl",[,,.2695,,.3831,.215,,.3887,,,,,,.1218,,.5948,,,1,,,,,.6],1),F.sn.a("zd",[3,,.199,.2506,.436,.0582,,.285,,.5539,.3764,-.7496,.7366,,,,,,1,,,,,.7],9),F.sn.a("ex",[3,,.3825,.4313,.3835,.7215,,-.3735,,,,,,,,,.0109,-.0889,1,,,,,.5],9),F.sn.a("go",[3,,.2291,.2146,.4937,.1678,,-.031,,.1136,.5919,-.7315,.8418,,,.7931,-.0576,-.0337,1,,,,,.6],1),F.sn.a("wn",[,.003,.762,,.555,.393,,.186,-.117,.685,.518,,,.4869,,.3,1,-.574,1,,,,,.7],1),F.sn.a("it",[,,.0114,,.1006,.4195,,.333,,,,,,.0069,,.5867,,,1,,,,,.5],10),F.sn.a("hb",[1,,.0609,,.1962,.3755,,-.6577,,,,,,1,,,,,1,,,,,.6],2),F.sn.a("fp",[2,,1,,,.3517,,,,,,,,,,,,,1,,,,,.7],1),F.scn={},F.scn.menu=new O,F.scn.game=new B,F.scn.menu.start()});